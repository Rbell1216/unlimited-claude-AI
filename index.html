<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puter Claude Clone</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Request Guest Mode -->
<script>
window.puter_config = {
  anonymous: true,
  disable_auth_ui: true
};
</script>
<script src="https://js.puter.com/v2/"></script>

<style>
/* RESET */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}

/* THEME */
:root{
--bg:#0f0f0f;
--panel:#1a1a1a;
--sidebar:#181818;
--border:#2a2a2a;
--accent:#ff6b35;
--text:#e5e5e5;
--muted:#888;
}
body{
font-family:system-ui,sans-serif;
background:var(--bg);
color:var(--text);
display:flex;
height:100vh;
}

/* SIDEBAR */
.sidebar{
width:260px;
background:var(--sidebar);
border-right:1px solid var(--border);
display:flex;
flex-direction:column;
}
.sidebar h2{
padding:15px;
font-size:18px;
border-bottom:1px solid var(--border);
}
.sidebar button{
margin:10px;
padding:10px;
border:none;
border-radius:8px;
background:var(--accent);
color:white;
cursor:pointer;
}
.chat-list{
flex:1;
overflow:auto;
}
.chat-item{
padding:12px 15px;
border-bottom:1px solid var(--border);
cursor:pointer;
}
.chat-item:hover{background:#222}
.chat-item.active{background:var(--accent);color:white}

/* MAIN */
.main{
flex:1;
display:flex;
flex-direction:column;
}
.topbar{
padding:10px 15px;
border-bottom:1px solid var(--border);
background:var(--panel);
font-size:14px;
}
.chat{
flex:1;
padding:20px;
overflow:auto;
}

/* MESSAGES */
.msg{
margin-bottom:15px;
padding:12px;
border-radius:10px;
max-width:75%;
white-space:pre-wrap;
line-height:1.5;
}
.user{
background:var(--accent);
color:white;
margin-left:auto;
}
.ai{
background:var(--panel);
border:1px solid var(--border);
}

/* INPUT */
.inputbar{
padding:12px;
border-top:1px solid var(--border);
display:flex;
gap:10px;
background:var(--panel);
}
textarea{
flex:1;
padding:12px;
border-radius:8px;
border:1px solid var(--border);
background:#0f0f0f;
color:var(--text);
resize:none;
}
button.send{
padding:12px 16px;
border:none;
border-radius:8px;
background:var(--accent);
color:white;
cursor:pointer;
}

/* AUTH OVERLAY */
#authOverlay{
position:fixed;
inset:0;
background:#000c;
display:none;
align-items:center;
justify-content:center;
z-index:9999;
}
#authBox{
background:#111;
padding:30px;
border-radius:14px;
text-align:center;
max-width:360px;
}
#authBox h2{margin-bottom:10px}
#authBox p{color:var(--muted);font-size:14px}
#authBox button{
margin-top:15px;
padding:12px 20px;
border:none;
border-radius:8px;
background:var(--accent);
color:white;
font-size:16px;
cursor:pointer;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>Claude Clone</h2>
  <button onclick="newChat()">➕ New Chat</button>
  <div class="chat-list" id="chatList"></div>
</div>

<!-- MAIN -->
<div class="main">
  <div class="topbar" id="status">Connecting to Puter…</div>
  <div class="chat" id="chat"></div>

  <div class="inputbar">
    <textarea id="input" rows="1" placeholder="Message Claude..."></textarea>
    <button class="send" onclick="sendMessage()">Send</button>
  </div>
</div>

<!-- AUTH OVERLAY -->
<div id="authOverlay">
  <div id="authBox">
    <h2>Continue to Claude</h2>
    <p>Puter needs to create a temporary session.</p>
    <button id="authBtn">Continue</button>
  </div>
</div>

<script>
/* ================= STATE ================= */
let chats = JSON.parse(localStorage.getItem("puterChats")||"[]");
let currentChat = null;

/* ================= CHAT STORAGE ================= */
function saveChats(){
  localStorage.setItem("puterChats",JSON.stringify(chats));
}

/* ================= UI ================= */
function addMessage(text, role){
  const div = document.createElement("div");
  div.className = "msg " + (role==="user"?"user":"ai");
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}

/* ================= CHAT LIST ================= */
function newChat(){
  const c={id:Date.now(),title:"New Chat",messages:[]};
  chats.unshift(c);
  currentChat=c;
  saveChats();
  renderChatList();
  renderMessages();
}

function renderChatList(){
  chatList.innerHTML="";
  chats.forEach(c=>{
    const d=document.createElement("div");
    d.className="chat-item"+(c===currentChat?" active":"");
    d.textContent=c.title;
    d.onclick=()=>{currentChat=c;renderChatList();renderMessages();};
    chatList.appendChild(d);
  });
}

function renderMessages(){
  chat.innerHTML="";
  if(!currentChat)return;
  currentChat.messages.forEach(m=>addMessage(m.content,m.role));
}

/* ================= AUTH FLOW ================= */
async function tryGuest(){
  try{
    await puter.ai.chat("ping",{model:"claude-sonnet-4"});
    status.textContent="✅ Guest session active";
  }catch(e){
    console.log("Guest blocked, showing overlay");
    status.textContent="Guest blocked – click Continue";
    authOverlay.style.display="flex";
  }
}

authBtn.onclick = async ()=>{
  status.textContent="Signing in...";
  await puter.auth.signIn({attempt_temp_user_creation:true});
  authOverlay.style.display="none";
  status.textContent="✅ Signed in";
};

/* ================= SEND MESSAGE ================= */
async function sendMessage(){
  const text=input.value.trim();
  if(!text||!currentChat)return;
  input.value="";

  if(currentChat.messages.length===0){
    currentChat.title=text.slice(0,30);
    renderChatList();
  }

  currentChat.messages.push({role:"user",content:text});
  addMessage(text,"user");

  const aiDiv = addMessage("...", "ai");

  try{
    const res = await puter.ai.chat(currentChat.messages,{
      model:"claude-sonnet-4",
      stream:true
    });

    let full="";
    for await(const chunk of res){
      if(chunk.text){
        full+=chunk.text;
        aiDiv.textContent=full;
      }
    }

    currentChat.messages.push({role:"assistant",content:full});
    saveChats();

  }catch(err){
    aiDiv.textContent="❌ "+err.message;
    console.error(err);
  }
}

/* ENTER SEND */
input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});

/* INIT */
if(chats.length===0)newChat();
else{currentChat=chats[0];renderChatList();renderMessages();}
document.addEventListener("DOMContentLoaded",tryGuest);
</script>

</body>
</html>
